"use strict";(self.webpackChunkspr_docs=self.webpackChunkspr_docs||[]).push([[1697],{95002:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var r=s(85893),i=s(11151);const t={sidebar_label:"Virtual Setup Guide"},o="Virtual Setup Guide",c={id:"setup_guides/virtual_spr",title:"Virtual Setup Guide",description:"SPR can run its services in a network namespace and expose Wireguard or DNS as services.",source:"@site/docs/setup_guides/virtual_spr.md",sourceDirName:"setup_guides",slug:"/setup_guides/virtual_spr",permalink:"/pages/docs/setup_guides/virtual_spr",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Virtual Setup Guide"},sidebar:"tutorialSidebar",previous:{title:"Setup Guide",permalink:"/pages/docs/setup_guides/setup_run_spr"},next:{title:"Overview",permalink:"/pages/docs/guides/overview"}},a={},l=[{value:"Quick Setup",id:"quick-setup",level:2},{value:"Host network configuration",id:"host-network-configuration",level:3},{value:"Manual configuration",id:"manual-configuration",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Start the SPR Services",id:"start-the-spr-services",level:3},{value:"Sign in to the Web UI",id:"sign-in-to-the-web-ui",level:3},{value:"Setup and connect to VPN",id:"setup-and-connect-to-vpn",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"virtual-setup-guide",children:"Virtual Setup Guide"}),"\n",(0,r.jsx)(n.p,{children:"SPR can run its services in a network namespace and expose Wireguard or DNS as services.\nThis is helpful for running SPR in the cloud as a personal VPN, for example."}),"\n",(0,r.jsx)(n.h2,{id:"quick-setup",children:"Quick Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'sudo bash -c "$(curl -fsSL https://raw.github.com/spr-networks/super/master/virtual_install.sh)"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This will download the ",(0,r.jsx)(n.a,{href:"https://github.com/spr-networks/super",children:"SPR repository"})," and run ",(0,r.jsx)(n.em,{children:"virtual_install.sh"}),".\nThe script will install dependencies, start all the containers and add one peer that can connect to the VPN.\nSee the next section for a walkthrough of the script."]}),"\n",(0,r.jsx)(n.p,{children:"If you want to add another device, just run the setup script again:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"cd super\nsudo ./virtual_install.sh\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Next ",(0,r.jsx)(n.a,{href:"#setup-and-connect-to-vpn",children:"setup"})," a client to connect to SPR over VPN."]}),"\n",(0,r.jsx)(n.h3,{id:"host-network-configuration",children:"Host network configuration"}),"\n",(0,r.jsx)(n.p,{children:"Your source ip address need to be able to access the host running spr on port 51280/udp.\nFor setup in the cloud, see the blog specific vendor guides for network configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/pages/blog/virtual-spr-on-a-gcloud-tier-free-instance#firewall-rules-for-vpn-access",children:"Google Cloud"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/pages/blog/virtual-spr-on-a-aws-micro-tier-instance#allow-vpn-access",children:"Amazon AWS"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/pages/blog/virtual-spr-on-a-digital-ocean-droplet",children:"Digital Ocean"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"manual-configuration",children:"Manual configuration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Clone the super repository"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/spr-networks/super.git\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Install dependencies"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"apt install -y curl git docker-compose docker.io jq qrencode iproute2 wireguard-tools\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Populate the configuration directory"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd super\ncp -R base/template_configs/ configs/\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Enable virtual config in ",(0,r.jsx)(n.code,{children:"configs/base/config.sh"})]})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp configs/base/virtual-config.sh configs/base/config.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"#!/bin/sh\nVIRTUAL_SPR=1\nUPSTREAM_SERVICES_ENABLE=1\nWANIF=eth0\nRUN_WAN_DHCP=true\nRUN_WAN_DHCP_IPV=4\nLANIP=192.168.2.1\nDNSIP=$LANIP\nTINYNETSTART=192.168.2.4\nTINYNETSTOP=192.168.2.255\nTINYNETMASK=255.255.255.252\nTINYSLASHMASK=30\nWIREGUARD_PORT=51280\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Set an api username and password for the web UI"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'echo "{\\"admin\\" : \\"your password goes here\\"}" > configs/auth/auth_users.json\n'})}),"\n",(0,r.jsx)(n.h3,{id:"start-the-spr-services",children:"Start the SPR Services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-compose-virt.yml up -d\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Note: ",(0,r.jsxs)(n.em,{children:["On MacOS you may need to modify docker-compose-virt.yml to disable the ",(0,r.jsx)(n.code,{children:"journald"})," driver and enable the ",(0,r.jsx)(n.code,{children:"json-file"})," driver instead."]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Optional"})})," Copy the virtual config for easier control of the docker containers:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp docker-compose-virt.yml docker-compose.yml\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Now you can run ",(0,r.jsx)(n.code,{children:"docker-compose restart"})," in the super directory to restart all the containers."]}),"\n",(0,r.jsx)(n.h3,{id:"sign-in-to-the-web-ui",children:"Sign in to the Web UI"}),"\n",(0,r.jsx)(n.p,{children:"The API is setup to listen on localhost:8000 on the host.\nTo access the service from your local machine, forward port 8000 using ssh:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh $HOST -N -L 8000:127.0.0.1:8000\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Navigate to ",(0,r.jsx)(n.a,{href:"http://localhost:8000/%5D",children:"http://localhost:8000/"})]}),"\n",(0,r.jsx)(n.p,{children:"Sign in with the username and password assigned in step 3 of the configuration."}),"\n",(0,r.jsx)(n.h3,{id:"setup-and-connect-to-vpn",children:"Setup and connect to VPN"}),"\n",(0,r.jsxs)(n.p,{children:["In the SPR web UI, navigate to VPN and click ",(0,r.jsx)(n.strong,{children:"Add peer"}),", enable the ",(0,r.jsx)(n.em,{children:"lan"})," group if you want to be able to connect to the admin interface over VPN."]}),"\n",(0,r.jsxs)(n.p,{children:["Click ",(0,r.jsx)(n.strong,{children:"Save"})," and download the client config or scan the QR Code on your phone with the official ",(0,r.jsx)(n.a,{href:"https://www.wireguard.com/install/",children:"WireGuard"})," (",(0,r.jsx)(n.em,{children:"\xa9 Jason A. Donenfeld"}),") client."]}),"\n",(0,r.jsxs)(n.p,{children:["Check ",(0,r.jsx)(n.a,{href:"/pages/blog/virtual%20SPR#configure-the-vpn-client-on-your-device",children:"this guide"})," on how to setup the VPN client for your device."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Note"})})," SPR exposes port 51280 over UDP (see ",(0,r.jsx)(n.code,{children:"$WIREGUARD_PORT"})," in config.sh) on the host.\nIf a firewall is present you will need to allow access to this port. Check the documentation for your hosting provider on how to do this."]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>o});var r=s(67294);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);